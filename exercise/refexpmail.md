[До збірника задач](README.md)

# Перевірка символьної адреси електронної пошти та паролю на коректність 

Автор: Олександр Пупена

Частина програми взята з прикладу Ubostech [Налаштування авторизаційного темплейту](https://community.ubos.tech/olha/nalashtuvannia-avtorizatsiinogho-tiemplieitu-27la)

## Завдання

Написати фрагмент програми на Node-RED, який перевіряє коректність символьної адреси електронної пошти та паролю, які передаються в корисному навантаженні (`msg.payload.email` і `msg.payload.password` ) та перенаправляє потік в залежності від результату:

- коректності паролю та адреси пошти
- некоректності адреси пошти
- некоректності паролю при коректності адреси пошти

Поштова адреса повинна складатися з трьох частин:

- ім'я логіна:
  - повинно мати принаймні один незаборонений символ
  - може включати крапки, після яких повинен йти принаймні один незаборонений символ
  - до заборонених символів відносяться:  `<>()[].,;:@"` та пробільні символи
- символ `@`
- доменне ім'я:
  - повинно включати принаймні одну групу незаборонених символів, що закінчуються крапкою, після якого йдуть символи домена першого рівня з 2-х `.xx` або більше літер
  - до заборонених символів відносяться:  `<>()[].,;:@"` та пробільні символи 

Необхідно перевірити рядок з паролем, який має відповідати наступним вимогам:

- мінімальна довжина - 8 символів.
- має містити принаймні одну велику літеру (A-Z).
- має містити принаймні одну малу літеру (a-z).
- має містити принаймні одну цифру (0-9).
- має містити принаймні один спеціальний символ (наприклад, !@#$%^&*()_+-=[]{}|;':",./<>?)
- не може містити пробільних символів

## Рішення 1

У даному рішенні використовуються регулярні вирази, які слугують для перевірки наявності та відсутності символів в рядках, про які можна почитати [за цим посиланням](https://github.com/pupenasan/ProgIngContrSystems/blob/master/%D0%9B%D0%B5%D0%BA%D1%86/regexp.md) 

### Означення регулярних виразів

Для перевірки коректності адреси пошти використовується наступний регулярний вираз: 

```
^([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$
```

Для перевірки коректності паролю наступні:

```
(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{}|;':",./<>?])(?!.*\s).{8,}
```

Дані регулярні вирази пояснюються в прикладах [за посиланням](Регулярні вирази дуже потужний інструмент, але я його завжди намагаюся обійти. Дійшов до задачки перевірки коректності адреси електронної пошти, де без регулярних виразів ніяк. Вирішив її розібрати по полочкам, тому прохання експертів в темі глянути і прокоментувати. https://github.com/pupenasan/ProgIngContrSystems/blob/master/%D0%9B%D0%B5%D0%BA%D1%86/regexp.md#%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D1%96%D1%80%D0%BA%D0%B0-%D0%BA%D0%BE%D1%80%D0%B5%D0%BA%D1%82%D0%BD%D0%BE%D1%81%D1%82%D1%96-%D0%BF%D0%BE%D1%88%D1%82%D0%BE%D0%B2%D0%BE%D1%97-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%B8) 

### Реалізація в Node-RED

Для реалізації можна скористатися вузлом `function` з трьом виходами.

![image-20230507184633149](media/image-20230507184633149.png)

Код функції:

```js
const regexEmail = /^([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
const regexPassword = /(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{}|;':",./<>?])(?!.*\s).{8,}/;
const email = msg.payload.email.toLowerCase();

if (!regexEmail.test(email)) {
    msg.payload.cheresult = "Некоректна пошта";
    return [null, msg, null];
} else if (!regexPassword.test(msg.payload.password)) {
    msg.payload.cheresult = "Некоректно заданий пароль";    
    return [null, null, msg];
} else {
    msg.payload.cheresult = "Пароль і пошта коректні";  
    return [msg, null, null];
}
```

Для перевірки можна використати три варіанти `msg.payload`:

```json
{
    "email": "user@mail.net",
    "password": "Passw0rd_correct"
}
```

```json
{
    "email": "user@mail",
    "password": "Passw0rd_correct"
}
```

```json
{
    "email": "user@mail.ne",
    "password": "Passw0rd
```

